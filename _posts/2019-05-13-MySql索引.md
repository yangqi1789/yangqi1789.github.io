---
layout:     post
title:      MySql索引
subtitle:   如何用redis实现分布式锁
date:       2019-05-13
author:     YQ
header-img: img/post-bg-ios9-web.jpg
catalog: true
sidebar: true
tags:
    - 索引
---
                                                                                                      
# MySql索引

## 什么事MySql索引

是一种帮助mysql高效的获取数据的数据结构，这些数据结构以某种方式引用数据，这种结构就是索引。

索引本地是将数据库的数据存储加上目录，可以通过目录在更小的范围进行查找，本质是用空间换取时间。

## 索引的优缺点

### 索引的优点

1. 通过创建唯一索引，可以保证数据库每一行数据的唯一性
2. 可以大大提高查询速度
3. 可以加速表与表的连接
4. 可以显著的减少查询中分组和排序的时间。

### 索引的缺点

1. 创建索引和维护索引需要时间，而且数据量越大时间越长
2. 创建索引需要占据磁盘的空间，如果有大量的索引，可能比数据文件更快达到最大文件尺寸
3. 当对表中的数据进行增加，修改，删除的时候，索引也要同时进行维护，降低了数据的维护速度

## 聚簇索引和非聚簇索引

MySQL中最常见的两种存储引擎分别是MyISAM和InnoDB，分别实现了非聚簇索引和聚簇索引。

聚簇索引的解释是:聚簇索引的顺序就是数据的物理存储顺序

非聚簇索引的解释是:索引顺序与数据物理排列顺序无关

### MyISAM——非聚簇索引

* MyISAM存储引擎采用的是非聚簇索引，非聚簇索引的主索引和辅助索引几乎是一样的，只是主索引不允许重复，不允许空值，他们的叶子结点的key都存储指向键值对应的数据的物理地址。
* 非聚簇索引的数据表和索引表是分开存储的。
* 非聚簇索引中的数据是根据数据的插入顺序保存。因此非聚簇索引更适合单个数据的查询。插入顺序不受键值影响。
* 只有在MyISAM中才能使用FULLTEXT索引。(mysql5.6以后innoDB也支持全文索引)

### InnoDB——聚簇索引

* 聚簇索引的主索引的叶子结点存储的是键值对应的数据本身，辅助索引的叶子结点存储的是键值对应的数据的主键键值。因此主键的值长度越小越好，类型越简单越好。
* 聚簇索引的数据和主键索引存储在一起。
* 聚簇索引的数据是根据主键的顺序保存。因此适合按主键索引的区间查找，可以有更少的磁盘I/O，加快查询速度。但是也是因为这个原因，聚簇索引的插入顺序最好按照主键单调的顺序插入，否则会频繁的引起页分裂，严重影响性能。
* 在InnoDB中，如果只需要查找索引的列，就尽量不要加入其它的列，这样会提高查询效率。

## 索引的建立方法

1. 建表时建立索引

    ```
    CREATE TABLE user_info (
	    id INT AUTO_INCREMENT COMMENT '用户id',
        user_account VARCHAR(16) COMMENT '用户账号',
        age int(3) COMMENT '年龄',
        sex int(1) COMMENT '性别',
	    role_id VARCHAR(16) COMMENT '角色id',
	    -- 主键本身也是一种索引（注:也可以在上面的创建字段时使该字段主键自增）
        PRIMARY KEY (id),
	    -- 主外键约束（注:role表中的id字段约束了此表中的role_id字段）
	    FOREIGN KEY (role_id) REFERENCES role (id),
	    -- 给user_account字段创建了唯一索引(注:也可以在上面的创建字段时使用unique来创建唯一索引)
	    UNIQUE INDEX (user_account),
	    -- 给age字段创建普通索引
	    INDEX (age),
        -- 给age,sex建立组合索引
        INDEX (age,sex)
	    -- 指定使用INNODB存储引擎(该引擎支持事务)、utf8字符编码
    ) ENGINE = INNODB DEFAULT CHARSET = utf8 COMMENT '项目附件表';
    ```